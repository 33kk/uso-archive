# ПланФикс - Нанокарточки в Планировщике (by Kirr) (138443)

### Information
- Author: Kirrrr (unknown)
- Created at: 2/3/2017, 1:23:45 AM
- Updated at: 11/14/2018, 9:16:35 PM
- License: NO-REDISTRIBUTION
- Category: planfix
- Rating: undefined
- Total installs: 151
- Weekly installs: 0


### Description
Делает карточки в Планировщике компактными.

Экспериментальный стиль! Пробуйте, только если сильно интересно.

Применяется для страниц в доменах planfix.ru, planfix.com и planfix.ua.

### Update notes
(описание желательно прочитать хотя бы до части про нюансы и технические внутренности)

На скриншоте слева — карточка в обычном виде, справа — в виде "нанокарточки".

Изменения:
14.11.2018 — добавил для использования нанокарточек в списке типа "Таблица" дополнительный самостоятельный стиль "Нанокарточки для «Таблицы»", в остальном аналогичный данному: <a href="https://userstyles.org/styles/165959/by-kirr" target="_blank">https://userstyles.org/styles/165959/by-kirr</a>
13.05.2018 — поправлен механизм применения стиля к нужным колонкам (после изменений в коде страницы стиль перестал иногда применяться); добавлена коррекция стиля для количества дней просрочки.

Производимый эффект:
— уменьшает вертикальное расстояние между карточками в списке;
— уменьшает отступы внутри карточки;
— убирает горизонтальные разделительные линии между полями;
— уменьшает шрифт названия задачи и делает его нежирным (размер и жирность можно выбрать);
— скрывает подписи у большинства полей (естественно, это ограничивает применение стиля теми вариантами компоновки карточек, в которых суть информации, отображаемой в данных полях, ясна и без подписей);
— часть скрываемых подписей можно оставить видимыми, это касается полей "Контрагент", "Процесс", "Проверка результата" и, возможно, каких-то ещё (действует только, если поле размещено в карточке третьим или ниже);
— большинство текстовых полей (кроме таких, как название задачи, списки пользователей с аватарами, описание задачи, чек-лист, прикреплённые файлы) собираются подряд в одной строке (без переноса по словам), а не занимают отдельные строки (отступ между полями можно выбрать);
— можно скрыть отображение надписи "не указана" в поле "Надзадача", если надзадачи нет (действует только, если поле размещено первым или вторым в карточке, см. подробности ниже);
— можно выбрать размер аватаров в списках пользователей (стандартный размер — 40 пикселей);
— позволяет разместить список аватаров пользователей справа от подписи в одной строке с ней, что может быть удобным, если размер аватаров мелкий.

Настраиваемые параметры выбираются при установке/обновлении стиля отсюда в полях ввода вверху.

Почему "нанокарточки"? Потому что обычные карточки в коде страницы называются "микрокарточками". :-)

Самый первый вопрос: как указать, для какого списка нужно включить компактное отображение? Ведь обычное отображение тоже нужно.
Говоря по-простому: чтобы переключить отображение в другой режим, надо немножечко изменить ширину колонки в любую строну (буквально на пару миллиметров).
Почему именно так и как именно оно работает.
К сожалению, мне не удалось найти среди доступных настраиваемых свойств списка такое, которое можно было бы использовать в качестве своего рода галочки "Отображать карточки данного списка компактно". Потому пришлось применить достаточно необычное решение. 
Во-первых, компактный вид применяется не к отдельному списку, а ко всем спискам в одной колонке, если их там несколько. По идее, это не страшное ограничение, так как вряд ли сильно понадобится в одну колонку поместить и компактный список, и обычный.
Во-вторых, включение/выключение компактного вида определяется шириной колонки в Планировщике. Если ширина в пикселях оканчивается на цифру от 5 до 9, то включается компактное отображение, если оканчивается на цифру от 0 до 4, то стиль не применяется и действует обычное отображение (в css-коде это выглядит жутковато, но что поделать). Кстати, ширина колонки по умолчанию, она же — минимальная ширина, равна 260 пикселям, соответственно, для такой колонки компактный вид не будет применён.


Само собой, решение целиком полагается на то, что однажды заданная ширина колонки не изменится без прямого вмешательства пользователя и будет одинаковой на любом устройстве, с которого пользователь открывает сайт ПланФикса. Но, вроде бы, работает чётко и стабильно.


Далее — описание нюансов и технических внутренностей.

Html-код карточек не позволяет средствами css выделить поля определённых типов — элементы кода просто не имеют подходящих отличительных признаков (увы, текстовое содержимое css воспринимать не умеет). Из-за этого невозможно сделать какую-либо произвольную индивидуальную настройку полей (скажем, выборочное отображение подписей) и стили применяются сразу ко многим разнородным (с точки зрения пользователя) полям, для выявления которых используются косвенные признаки и побочные эффекты.
Особую нервотрёпку в этом аспекте вызвала реализация функции скрытия надписи "не указана" в поле "Надзадача". Когда поле "Надзадача" отображает надпись "не указана", с точки зрения сss оно неотличимо от таких текстовых полей, как "Контрагент", "Процесс" и "Проверка результата" (и, возможно, каких-то ещё). Чтобы получить желаемый результат с минимумом побочных эффектов, действие этой функции пришлось ограничить первым и вторым полем в карточке (предполагается, что поле "Надзадача" ставится вверху, сразу после поля "Группа проектов / Проект"). 
Кроме того, для скрытия надписи "не указана" пришлось использовать весьма радикальный метод, который оказывает неявное влияние на всю карточку. В результате, возможно, что при некоторых вариантах настройки карточек, эта функция может приводить к побочному эффекту, выражающемуся в скрытии и каких-то других надписей.

В "сухом остатке": Поле "Надзадача", для достижения задуманного эффекта, надо ставить в карточке первым или вторым. Поля "Контрагент", "Процесс" и "Проверка результата", для нормального отображения надо ставить третьим или ниже.

Вот так вот всё запутано. Именно поэтому стиль назван экспериментальным. :-)


Тема на форуме ПланФикса: <a href="https://forum.planfix.ru/viewtopic.php?f=34&t=4004" target="_blank">https://forum.planfix.ru/viewtopic.php?f=34&t=4004</a>

P.S. Если стиль окажется для вас полезным и у вас возникнет желание отблагодарить меня условной "чашкой капучино", то это можно легко сделать тут: https://money.yandex.ru/to/410012920197755 :-)

Удачного пользования! :-)

### Screenshots (links to userstyles.org)
![https://userstyles.org/style_screenshots/138443_after.png](https://userstyles.org/style_screenshots/138443_after.png)
![https://userstyles.org/style_screenshots/138443_additional_24664.png](https://userstyles.org/style_screenshots/138443_additional_24664.png)
![https://userstyles.org/style_screenshots/138443_additional_24669.png](https://userstyles.org/style_screenshots/138443_additional_24669.png)
![https://userstyles.org/style_screenshots/138443_additional_24690.png](https://userstyles.org/style_screenshots/138443_additional_24690.png)
![https://userstyles.org/style_screenshots/138443_additional_24691.png](https://userstyles.org/style_screenshots/138443_additional_24691.png)

### Screenshots (archived)
![https://raw.githubusercontent.com/33kk/uso-archive/flomaster/data/screenshots/138443_after.png](https://raw.githubusercontent.com/33kk/uso-archive/flomaster/data/screenshots/138443_after.png)
